
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>eQTL analysis complete workflow &#8212; ADSP-FG Project</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="APA Calling" href="../molecular_phenotypes/apa_calling.html" />
    <link rel="prev" title="xQTL analysis pipeline" href="../../README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/xqtl_wf.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ADSP-FG Project</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   xQTL analysis pipeline
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Complete Pipelines
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   eQTL analysis complete workflow
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Molecular Phenotypes
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../molecular_phenotypes/apa_calling.html">
   APA Calling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Pre-processing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data_preprocessing/genotype_preprocessing.html">
   Genotype data preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/genotype/GWAS_QC.html">
     GWAS data QC workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/genotype/GRM.html">
     Genomic relationship matrices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/genotype/genotype_formatting.html">
     Genotype data reformat
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data_preprocessing/phenotype_preprocessing.html">
   Phenotype data preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/phenotype/normalization.html">
     Molecular phenotype normalization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/phenotype/phenotype_formatting.html">
     Phenotype data reformat
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data_preprocessing/covariate_preprocessing.html">
   Covariate data preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/covariate/PCA.html">
     Principal component analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/covariate/PEER_factor.html">
     Factor analysis using PEER
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/covariate/BiCV_factor.html">
     Factor analysis using Bi-Cross validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data_preprocessing/covariate/remove_covariates.html">
     Computing covariate residuals
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  QTL Association Testing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../association_scan/cisQTL_scan.html">
   cisQTL analysis workflows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../association_scan/TensorQTL/TensorQTL.html">
     TensorQTL QTL calling pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../association_scan/APEX/APEX_LMM.html">
     APEX QTL calling pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../association_scan/transQTL_scan.html">
   transQTL analysis workflows
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multivariate Integration
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../multivariate/METAL.html">
   Meta-analysis with METAL
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../multivariate/MASH_pipeline.html">
   Multivariate association with MASH
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../multivariate/MASH/fastqtl_to_mash.html">
     eQTL summary statistics formatting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../multivariate/MASH/mixture_prior.html">
     A multivariate EBNM approach for mixture multivariate distribution estimate
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../multivariate/MASH/mashr.html">
     MASH analysis pipeline with data-driven prior matrices
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Statistical Fine-mapping
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../fine_mapping/univariate_fine_mapping.html">
   Univariate fine-mapping workflows
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../fine_mapping/SuSiE/SuSiE_RSS.html">
     Fine-mapping with SuSiE RSS model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../fine_mapping/multivariate_fine_mapping.html">
   Multivariate fine-mapping workflows
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Utilities
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/summary_stats_merger.html">
   Summary statistics merger
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/rds_to_vcf.html">
   Summary statistics in VCF format
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Supported by <a href="https://www.nia.nih.gov/research/ad-genetics">NIH/NIA</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/pipeline/complete_analysis/eQTL_analysis.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/cumc/xqtl-pipeline/issues/new?title=Issue%20on%20page%20%2Fpipeline/complete_analysis/eQTL_analysis.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/cumc/xqtl-pipeline/edit/gh-pages/pipeline/complete_analysis/eQTL_analysis.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generation-of-mwe">
   Generation of MWE
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-for-running-the-workflow">
   Example for running the workflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#other-example-workflow">
   Other example workflow:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-processing">
   Data Processing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example">
     Example:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#qtl-associations">
   QTL associations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Example:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#meta-analysis">
   Meta Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fine-mapping">
   Fine mapping
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     Example
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="eqtl-analysis-complete-workflow">
<h1>eQTL analysis complete workflow<a class="headerlink" href="#eqtl-analysis-complete-workflow" title="Permalink to this headline">¶</a></h1>
<p>This notebook provide a master control on the XQTL workflow so it can works on multiple data collection as proposed.
Input:
A recipe file,each row is a data collection and with the following column:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Theme
    name of dataset, must be different, each uni_study analysis will be performed in a folder named after each, meta analysis will be performed in a folder named as {study1}_{study2}
        
    The column name must contain the # and be the first column

genotype_list
    {Path to file}

molecular_pheno
    {Path to file}
region_list (list of regions to be analzed)
    {Path to file}

covariate_file
    {Path to file}

factor_analysis_opt
    &quot;APEX&quot; vs &quot;PEER&quot; for factor analysis

LD options:
    &quot;In-sample&quot; LD vs {path to reference panel}

QTL_tool_option
    &quot;APEX&quot; vs &quot;TensorQTL&quot; for QTL association

QTL_analysis_option
    {Int for cis window} vs &quot;trans&quot;

Populations
    The populations from which of the samples was drawn

Conditions:
    The nature of molecular phenotype

### note: Only data collection from the same Populations and conditions will me merged to perform Fix effect meta analysis
</pre></div>
</div>
<p>Output:
…</p>
<div class="section" id="generation-of-mwe">
<h2>Generation of MWE<a class="headerlink" href="#generation-of-mwe" title="Permalink to this headline">¶</a></h2>
<p>This is the code to generate the mwe recipe and LD_recipe on csg cluster</p>
<p><strong>FIXME: Hao, I’m thinking that for this configuration file we should not speicify any parameter (eg <code class="docutils literal notranslate"><span class="pre">cis_windows</span></code> below), but only file locations and workflow names. the outcome of running this should also be that instead of running anything, we write the sequence of commands to execute to a <code class="docutils literal notranslate"><span class="pre">sh</span></code> file (with automatic comment strings <code class="docutils literal notranslate"><span class="pre">#</span></code> to separate the sections) for people to run on their own, so they will have better control over everything. Is there an issue with this plan? (please slack me for discussions on this if necessary). Otherwise, let’s focus first on finishing up the modules and worry about this the last?</strong></p>
<p><strong>FIXME: Also, this file should be those that reproduces exactly the official default Brain xQTL consortium analysis. That is why I would rather have it per xQTL type even if there will be duplicated lines of contents</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="n">Recipe_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="p">{</span><span class="s2">&quot;Theme&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;AC&quot;</span><span class="p">,</span><span class="s2">&quot;DLPFC&quot;</span><span class="p">,</span><span class="s2">&quot;PCC&quot;</span><span class="p">]</span> <span class="p">,</span>
                <span class="s2">&quot;genotype_list&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/hs3163/GIT/ADSPFG-xQTL/MWE/mwe_genotype_list&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;/home/hs3163/GIT/ADSPFG-xQTL/MWE/mwe_genotype_list&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;/home/hs3163/GIT/ADSPFG-xQTL/MWE/mwe_genotype_list&quot;</span><span class="p">],</span>
                <span class="s2">&quot;molecular_pheno&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/hs3163/Project/Rosmap/data/gene_exp/AC/geneTpmResidualsAgeGenderAdj_rename.txt&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;/home/hs3163/Project/Rosmap/data/gene_exp/DLPFC/geneTpmResidualsAgeGenderAdj_rename.txt&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;/home/hs3163/Project/Rosmap/data/gene_exp/PCC/geneTpmResidualsAgeGenderAdj_rename.txt&quot;</span><span class="p">],</span>
                <span class="s2">&quot;region_list&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;~/GIT/ADSPFG-xQTL/MWE/mwe_region&quot;</span><span class="p">,</span>
                <span class="s2">&quot;~/GIT/ADSPFG-xQTL/MWE/mwe_region&quot;</span><span class="p">,</span>
                <span class="s2">&quot;~/GIT/ADSPFG-xQTL/MWE/mwe_region&quot;</span><span class="p">]</span> <span class="p">,</span>
                <span class="s2">&quot;covariate_file&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/hs3163/GIT/ADSPFG-xQTL/MWE/MWE.cov&quot;</span><span class="p">,</span><span class="s2">&quot;/home/hs3163/GIT/ADSPFG-xQTL/MWE/MWE.cov&quot;</span><span class="p">,</span><span class="s2">&quot;/home/hs3163/GIT/ADSPFG-xQTL/MWE/MWE.cov&quot;</span><span class="p">],</span>
                <span class="s2">&quot;factor_analysis_opt&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;APEX&quot;</span><span class="p">,</span><span class="s2">&quot;APEX&quot;</span><span class="p">,</span><span class="s2">&quot;APEX&quot;</span><span class="p">],</span>
                <span class="s2">&quot;LD_Recipe&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;~/GIT/ADSPFG-xQTL/MWE/LD_Recipe&quot;</span><span class="p">,</span><span class="s2">&quot;~/GIT/ADSPFG-xQTL/MWE/LD_Recipe&quot;</span><span class="p">,</span><span class="s2">&quot;~/GIT/ADSPFG-xQTL/MWE/LD_Recipe&quot;</span><span class="p">],</span>
                <span class="s2">&quot;QTL_tool_option&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;APEX&quot;</span><span class="p">,</span><span class="s2">&quot;APEX&quot;</span><span class="p">,</span><span class="s2">&quot;APEX&quot;</span><span class="p">],</span>
                <span class="s2">&quot;QTL_analysis_option&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cis&quot;</span><span class="p">,</span><span class="s2">&quot;cis&quot;</span><span class="p">,</span><span class="s2">&quot;cis&quot;</span><span class="p">],</span>
                <span class="s2">&quot;cis_windows&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">500000</span><span class="p">,</span><span class="mi">500000</span><span class="p">,</span><span class="mi">5000000</span><span class="p">],</span>
                <span class="s2">&quot;Metal&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="s2">&quot;F&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;/home/hs3163/GIT/ADSPFG-xQTL/MWE/mwe_recipe_example&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">### note: Only data collection from the same Populations and conditions will me merged to perform Fix effect meta analysis</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;ld_file_prefix&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/mnt/mfs/statgen/neuro-twas/mv_wg/cache_arch/cache/geneTpmResidualsAgeGenderAdj_rename.&quot;</span><span class="p">,</span><span class="s2">&quot;/mnt/mfs/statgen/neuro-twas/mv_wg/cache_arch/cache/geneTpmResidualsAgeGenderAdj_rename.&quot;</span><span class="p">],</span>
               <span class="s2">&quot;ld_file_surfix&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;.merged.ld.rds&quot;</span><span class="p">,</span><span class="s2">&quot;.merged.ld.rds&quot;</span><span class="p">]})</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;~/GIT/ADSPFG-xQTL/MWE/LD_Recipe&quot;</span><span class="p">,</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="example-for-running-the-workflow">
<h2>Example for running the workflow<a class="headerlink" href="#example-for-running-the-workflow" title="Permalink to this headline">¶</a></h2>
<p>This will run the workflow from via several submission and save the output to nohup.out</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="n">nohup</span> <span class="n">sos</span> <span class="n">run</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">master_control</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">Fine_mapping</span> \
        <span class="o">--</span><span class="n">recipe</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">MWE</span><span class="o">/</span><span class="n">mwe_recipe_example</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="o">./</span> \
        <span class="o">--</span><span class="n">exe_dir</span> <span class="s2">&quot;~/GIT/ADSPFG-xQTL/workflow&quot;</span> <span class="o">-</span><span class="n">J</span> <span class="mi">50</span> <span class="o">-</span><span class="n">q</span> <span class="n">csg</span> <span class="o">-</span><span class="n">c</span> <span class="o">~/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">csg</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">s</span> <span class="n">build</span> <span class="o">&amp;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="other-example-workflow">
<h2>Other example workflow:<a class="headerlink" href="#other-example-workflow" title="Permalink to this headline">¶</a></h2>
<p>These command run each of the substep to test them individually</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="n">sos</span> <span class="n">run</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">master_control</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">data_proc</span> \
        <span class="o">--</span><span class="n">recipe</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">MWE</span><span class="o">/</span><span class="n">mwe_recipe_example</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="o">./</span> \
        <span class="o">--</span><span class="n">exe_dir</span> <span class="s2">&quot;~/GIT/ADSPFG-xQTL/workflow&quot;</span>

<span class="n">sos</span> <span class="n">run</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">master_control</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">QTL</span> \
        <span class="o">--</span><span class="n">recipe</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">MWE</span><span class="o">/</span><span class="n">mwe_recipe_example</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="o">./</span> \
        <span class="o">--</span><span class="n">exe_dir</span> <span class="s2">&quot;~/GIT/ADSPFG-xQTL/workflow&quot;</span>

<span class="n">sos</span> <span class="n">run</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">master_control</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">Meta</span> \
        <span class="o">--</span><span class="n">recipe</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">MWE</span><span class="o">/</span><span class="n">mwe_recipe_example</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="o">./</span> \
        <span class="o">--</span><span class="n">exe_dir</span> <span class="s2">&quot;~/GIT/ADSPFG-xQTL/workflow&quot;</span> 

<span class="n">sos</span> <span class="n">run</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">workflow</span><span class="o">/</span><span class="n">master_control</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">Fine_mapping</span> \
        <span class="o">--</span><span class="n">recipe</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">MWE</span><span class="o">/</span><span class="n">mwe_recipe_example</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="o">./</span> \
        <span class="o">--</span><span class="n">exe_dir</span> <span class="s2">&quot;~/GIT/ADSPFG-xQTL/workflow&quot;</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">global</span><span class="p">]</span>
<span class="c1">## The aforementioned input recipe</span>
<span class="kn">parameter:</span> <span class="n">recipe</span> <span class="o">=</span> <span class="n">path</span>
<span class="c1">## Overall wd, the file structure of analysis is wd/[steps]/[sub_dir for each steps]</span>
<span class="kn">parameter:</span>  <span class="n">wd</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="c1">## Diretory to the excutable</span>
<span class="kn">parameter:</span> <span class="n">exe_dir</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="s2">&quot;~/GIT/ADSPFG-xQTL/workflow&quot;</span><span class="p">)</span>

<span class="kn">parameter:</span> <span class="n">container</span> <span class="o">=</span> <span class="s1">&#39;/mnt/mfs/statgen/containers/twas_latest.sif&#39;</span>
<span class="kn">parameter:</span> <span class="n">container_lmm</span> <span class="o">=</span> <span class="s1">&#39;/mnt/mfs/statgen/containers/lmm.sif&#39;</span>
<span class="kn">parameter:</span> <span class="n">container_apex</span> <span class="o">=</span> <span class="s1">&#39;/mnt/mfs/statgen/containers/apex.sif&#39;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">input_inv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">recipe</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">Metal_theme</span> <span class="o">=</span> <span class="n">input_inv</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Metal == &#39;T&#39;&quot;</span><span class="p">)[</span><span class="s2">&quot;Theme&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">Metal_theme_str</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Metal_theme</span><span class="p">)</span>
<span class="n">Non_Metal_theme</span> <span class="o">=</span> <span class="n">input_inv</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;Metal != &#39;T&#39;&quot;</span><span class="p">)[</span><span class="s2">&quot;Theme&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">Non_Metal_theme</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Metal_theme_str</span><span class="p">)</span>
<span class="n">Theme_Prefix</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Non_Metal_theme</span><span class="p">)</span>

<span class="kn">parameter:</span> <span class="n">LD_Recipe</span>  <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">input_inv</span><span class="p">[</span><span class="s2">&quot;LD_Recipe&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">input_inv</span> <span class="o">=</span> <span class="n">input_inv</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-processing">
<h2>Data Processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">data_proc</span><span class="p">]</span>
<span class="kn">input:</span> <span class="n">for_each</span> <span class="o">=</span> <span class="s2">&quot;input_inv&quot;</span>
<span class="kn">output:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wd</span><span class="si">}</span><span class="s1">/Data_Processing/</span><span class="si">{</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;Theme&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">.data_proc_output_recipe.tsv&#39;</span>
<span class="c1">#task: trunk_workers = 1, trunk_size = 1, walltime = &#39;24h&#39;,  mem = &#39;40G&#39;, tags = f&#39;{step_name}_{_output[0]:bn}&#39;</span>
<span class="kn">bash:</span>  <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;$[ ]&quot;</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stderr&#39;</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stdout&#39;</span>
    <span class="n">sos</span> <span class="n">run</span> <span class="err">$</span><span class="p">[</span><span class="n">exe_dir</span><span class="p">]</span><span class="o">/</span><span class="n">Data_Processing</span><span class="o">/</span><span class="n">Data_Processing</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">Recipe</span> \
        <span class="o">--</span><span class="n">molecular_pheno_whole</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;molecular_pheno&quot;</span><span class="p">]]</span> \
        <span class="o">--</span><span class="n">region_list</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;region_list&quot;</span><span class="p">]]</span> \
        <span class="o">--</span><span class="n">genotype_list</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;genotype_list&quot;</span><span class="p">]]</span> \
        <span class="o">--</span><span class="n">covariate</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;covariate_file&quot;</span><span class="p">]]</span> \
        <span class="o">--</span><span class="kp">name</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;Theme&quot;</span><span class="p">]]</span> \
        <span class="o">--</span><span class="n">container_lmm</span> <span class="err">$</span><span class="p">[</span><span class="n">container_lmm</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">container</span> <span class="err">$</span><span class="p">[</span><span class="n">container</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">container_apex</span> <span class="err">$</span><span class="p">[</span><span class="n">container_apex</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="err">$</span><span class="p">[</span><span class="n">wd</span><span class="p">:</span><span class="n">a</span><span class="p">]</span><span class="o">/</span><span class="n">Data_Processing</span><span class="o">/</span> \
        <span class="o">--</span><span class="n">factor_option</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;factor_analysis_opt&quot;</span><span class="p">]]</span> \
        <span class="o">-</span><span class="n">J</span> <span class="mi">200</span> <span class="o">-</span><span class="n">q</span> <span class="n">csg</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">csg</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example">
<h3>Example:<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>sos run /home/hs3163/GIT/ADSPFG-xQTL/workflow/Data_Processing/Data_Processing.ipynb Recipe <br />
–molecular_pheno_whole /home/hs3163/Project/Rosmap/data/gene_exp/PCC/geneTpmResidualsAgeGenderAdj_rename.txt <br />
–region_list ~/GIT/ADSPFG-xQTL/MWE/mwe_region_long <br />
–genotype_list /home/hs3163/GIT/ADSPFG-xQTL/MWE/mwe_genotype_list <br />
–covariate None <br />
–name PCC <br />
–container_lmm /mnt/mfs/statgen/containers/lmm.sif <br />
–container /mnt/mfs/statgen/containers/twas_latest.sif <br />
–container_apex /mnt/mfs/statgen/containers/apex.sif <br />
–wd /mnt/mfs/statgen/xqtl_workflow_testing/testing_no_cov/Data_Processing/ <br />
–factor_option APEX <br />
-J 200 -q csg -c /home/hs3163/GIT/ADSPFG-xQTL/code/csg.yml</p>
</div>
</div>
<div class="section" id="qtl-associations">
<h2>QTL associations<a class="headerlink" href="#qtl-associations" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">QTL_1</span><span class="p">]</span>
<span class="kn">input:</span> <span class="n">output_from</span><span class="p">(</span><span class="s2">&quot;data_proc&quot;</span><span class="p">),</span><span class="n">group_with</span> <span class="o">=</span> <span class="s2">&quot;input_inv&quot;</span>
<span class="kn">output:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wd</span><span class="si">:</span><span class="s1">a</span><span class="si">}</span><span class="s1">/QTL_association/</span><span class="si">{</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;Theme&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;QTL_tool_option&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;QTL_analysis_option&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">_QTL_recipe.tsv&#39;</span>
<span class="c1">#task: trunk_workers = 1, trunk_size = 1, walltime = &#39;24h&#39;,  mem = &#39;40G&#39;, tags = f&#39;{step_name}_{_output[0]:bn}&#39;</span>
<span class="kn">bash:</span>  <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;$[ ]&quot;</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stderr&#39;</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stdout&#39;</span>
    <span class="n">sos</span> <span class="n">run</span> <span class="err">$</span><span class="p">[</span><span class="n">exe_dir</span><span class="p">]</span><span class="o">/</span><span class="n">QTL_association</span><span class="o">/</span><span class="n">QTL_association</span><span class="o">.</span><span class="n">ipynb</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;QTL_tool_option&quot;</span><span class="p">]]</span><span class="n">_</span><span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;QTL_analysis_option&quot;</span><span class="p">]]</span><span class="n">_Recipe</span> \
        <span class="o">--</span><span class="n">recipe</span> <span class="err">$</span><span class="p">[</span><span class="n">_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> \
        <span class="o">--</span><span class="n">container</span> <span class="err">$</span><span class="p">[</span><span class="n">container_apex</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">window</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;cis_windows&quot;</span><span class="p">]]</span> \
        <span class="o">--</span><span class="kp">name</span> <span class="err">$</span><span class="p">[</span><span class="n">_input_inv</span><span class="p">[</span><span class="s2">&quot;Theme&quot;</span><span class="p">]]</span>  \
        <span class="o">--</span><span class="n">wd</span> <span class="err">$</span><span class="p">[</span><span class="n">wd</span><span class="p">:</span><span class="n">a</span><span class="p">]</span><span class="o">/</span><span class="n">QTL_association</span><span class="o">/</span> \
        <span class="o">-</span><span class="n">J</span> <span class="mi">200</span> <span class="o">-</span><span class="n">q</span> <span class="n">csg</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">csg</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Example:<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>sos run /home/hs3163/GIT/ADSPFG-xQTL/workflow/QTL_association/QTL_association.ipynb APEX_cis_Recipe <br />
–recipe Data_Processing/PCC.data_proc_output_recipe.tsv <br />
–container /mnt/mfs/statgen/containers/apex.sif <br />
–window 500000 <br />
–name PCC  <br />
–wd /mnt/mfs/statgen/xqtl_workflow_testing/testing_no_cov/QTL_association/ <br />
-J 200 -q csg -c /home/hs3163/GIT/ADSPFG-xQTL/code/csg.yml</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">QTL_2</span><span class="p">]</span>
<span class="kn">input:</span> <span class="n">group_by</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>  
<span class="kn">output:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">/sumstat_list&#39;</span>
<span class="kn">python:</span> <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;$[ ]&quot;</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stderr&#39;</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stdout&#39;</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="err">$</span><span class="p">[</span><span class="n">_input</span><span class="p">:</span><span class="n">r</span><span class="p">,]]</span>
    <span class="n">input_inv</span> <span class="o">=</span> <span class="err">$</span><span class="p">[</span><span class="n">input_inv</span><span class="p">]</span>
    <span class="n">chr_temp</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;chr&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>  <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="n">sumstat_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;chr&quot;</span> <span class="p">:</span> <span class="n">chr_temp</span> <span class="p">})</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">input_list</span><span class="p">)):</span>
        <span class="n">sumstat_list</span> <span class="o">=</span> <span class="n">sumstat_list</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">input_inv</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s2">&quot;Theme&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_list</span><span class="p">[</span><span class="n">x</span><span class="p">])}</span> <span class="p">)</span>
    <span class="n">sumstat_list</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;$[_output]&quot;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="meta-analysis">
<h2>Meta Analysis<a class="headerlink" href="#meta-analysis" title="Permalink to this headline">¶</a></h2>
<p>Input:</p>
<ol class="simple">
<li><p>A recipe generated from the combination of previouse steps</p></li>
</ol>
<p>Output:</p>
<ol class="simple">
<li><p>Recipe for Prior, Vhat, rds input, resid corr</p></li>
<li><p>vcf</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Meta</span><span class="p">]</span>
<span class="kn">input:</span> <span class="n">output_from</span><span class="p">(</span><span class="s2">&quot;QTL_2&quot;</span><span class="p">)</span>
<span class="kn">output:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wd</span><span class="si">}</span><span class="s1">/Meta_analysis/Fine_mapping_recipe.txt&#39;</span>
<span class="c1">#task: trunk_workers = 1, trunk_size = 1, walltime = &#39;24h&#39;,  mem = &#39;40G&#39;, tags = f&#39;{step_name}_{_output[0]:bn}&#39;</span>
<span class="kn">bash:</span>  <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;$[ ]&quot;</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stderr&#39;</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stdout&#39;</span>
    <span class="n">sos</span> <span class="n">run</span> <span class="err">$</span><span class="p">[</span><span class="n">exe_dir</span><span class="p">]</span><span class="o">/</span><span class="n">Meta_Analysis</span><span class="o">/</span><span class="n">Meta_Analysis</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">Recipe</span> \
        <span class="o">--</span><span class="n">sumstat_list_path</span> <span class="err">$</span><span class="p">[</span><span class="n">_input</span><span class="p">:</span><span class="n">a</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">region_list</span> <span class="err">$</span><span class="p">[</span><span class="n">input_inv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;region_list&quot;</span><span class="p">]]</span> \
        <span class="o">--</span><span class="n">container</span> <span class="err">$</span><span class="p">[</span><span class="n">container</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="err">$</span><span class="p">[</span><span class="n">wd</span><span class="p">:</span><span class="n">a</span><span class="p">]</span><span class="o">/</span><span class="n">Meta_analysis</span><span class="o">/</span> \
        <span class="o">--</span><span class="n">METAL_theme_str</span> <span class="err">$</span><span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Metal_theme</span><span class="p">)]</span> \
        <span class="o">-</span><span class="n">J</span> <span class="mi">200</span> <span class="o">-</span><span class="n">q</span> <span class="n">csg</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hs3163</span><span class="o">/</span><span class="n">GIT</span><span class="o">/</span><span class="n">ADSPFG</span><span class="o">-</span><span class="n">xQTL</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">csg</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>sos run /home/hs3163/GIT/ADSPFG-xQTL/workflow/Meta_Analysis/Meta_Analysis.ipynb Recipe <br />
–sumstat_list_path /mnt/mfs/statgen/xqtl_workflow_testing/testing_no_cov/QTL_association/sumstat_list <br />
–region_list ~/GIT/ADSPFG-xQTL/MWE/mwe_region_long <br />
–container /mnt/mfs/statgen/containers/twas_latest.sif <br />
–wd /mnt/mfs/statgen/xqtl_workflow_testing/testing_no_cov/Meta_analysis/ <br />
–METAL_theme_str PCC,DLPFC <br />
-J 200 -q csg -c /home/hs3163/GIT/ADSPFG-xQTL/code/csg.yml</p>
</div>
</div>
<div class="section" id="fine-mapping">
<h2>Fine mapping<a class="headerlink" href="#fine-mapping" title="Permalink to this headline">¶</a></h2>
<p>Input:</p>
<ol class="simple">
<li><p>Recipe from previous step</p></li>
<li><p>a Recipe for LD, need to be made seperately</p></li>
</ol>
<p>Output: vcf</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-sos notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Fine_mapping</span><span class="p">]</span>
<span class="kn">input:</span> <span class="n">output_from</span><span class="p">(</span><span class="s2">&quot;Meta&quot;</span><span class="p">)</span>
<span class="kn">output:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wd</span><span class="si">}</span><span class="s1">/Fine_Mapping/</span><span class="si">{</span><span class="n">Theme_Prefix</span><span class="si">}</span><span class="s1">.unisusie_rss.output_list.txt&#39;</span><span class="p">,</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">wd</span><span class="si">}</span><span class="s1">/Fine_Mapping/</span><span class="si">{</span><span class="n">Theme_Prefix</span><span class="si">}</span><span class="s1">.mvsusie_rss.output_list.txt&#39;</span>
<span class="c1">#task: trunk_workers = 1, trunk_size = 1, walltime = &#39;24h&#39;,  mem = &#39;40G&#39;, tags = f&#39;{step_name}_{_output[0]:bn}&#39;</span>
<span class="kn">bash:</span> <span class="n">expand</span> <span class="o">=</span> <span class="s2">&quot;$[ ]&quot;</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stderr&#39;</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.stdout&#39;</span>
    <span class="n">sos</span> <span class="n">run</span> <span class="err">$</span><span class="p">[</span><span class="n">exe_dir</span><span class="p">]</span><span class="o">/</span><span class="n">Fine_Mapping</span><span class="o">/</span><span class="n">SumStat</span><span class="o">/</span><span class="n">SuSiE_RSS</span><span class="o">.</span><span class="n">ipynb</span> <span class="n">Fine_mapping</span> \
        <span class="o">--</span><span class="n">recipe</span> <span class="err">$</span><span class="p">[</span><span class="n">_input</span><span class="p">:</span><span class="n">a</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">LD_Recipe</span> <span class="err">$</span><span class="p">[</span><span class="n">LD_Recipe</span><span class="p">:</span><span class="n">a</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">container</span> <span class="err">$</span><span class="p">[</span><span class="n">container</span><span class="p">]</span> \
        <span class="o">--</span><span class="n">wd</span> <span class="err">$</span><span class="p">[</span><span class="n">wd</span><span class="p">:</span><span class="n">a</span><span class="p">]</span><span class="o">/</span><span class="n">Fine_Mapping</span><span class="o">/</span> \
        <span class="o">--</span><span class="n">Theme_prefix</span> <span class="err">$</span><span class="p">[</span><span class="n">Theme_Prefix</span><span class="p">]</span> <span class="c1"># \</span>
        <span class="c1">#-J 50 -q csg -c ~/GIT/ADSPFG-xQTL/code/csg.yml &amp;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>sos run /home/hs3163/GIT/ADSPFG-xQTL/workflow/Fine_Mapping/SumStat/SuSiE_RSS.ipynb Fine_mapping <br />
–recipe /mnt/mfs/statgen/xqtl_workflow_testing/testing_no_cov/Meta_analysis/Fine_mapping_recipe.txt <br />
–LD_Recipe /home/hs3163/GIT/ADSPFG-xQTL/MWE/LD_Recipe <br />
–container /mnt/mfs/statgen/containers/twas_latest.sif <br />
–wd /mnt/mfs/statgen/xqtl_workflow_testing/testing_no_cov/Fine_Mapping/ <br />
–Theme_prefix AC_PCC-DLPFC # <br />
# -J 50 -q csg -c ~/GIT/ADSPFG-xQTL/code/csg.yml &amp;</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "sos"
        },
        kernelOptions: {
            kernelName: "sos",
            path: "./pipeline/complete_analysis"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'sos'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../../README.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">xQTL analysis pipeline</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../molecular_phenotypes/apa_calling.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">APA Calling</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The NIH/NIA Alzheimer's Disease Sequencing Project Functional Genomics Consortium<br/>
        
            &copy; Copyright 2021, ADSP-FG xQTL methods and data integration subgroup.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>